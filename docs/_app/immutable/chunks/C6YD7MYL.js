import{q as e,A as s,B as t,C as o,D as n,E as i,o as c,F as f,G as r,H as a}from"./CPmqCMFw.js";class h{anchor;#e=new Map;#s=new Map;#t=new Map;#o=new Set;#n=!0;constructor(e,s=!0){this.anchor=e,this.#n=s}#i=()=>{var i=e;if(this.#e.has(i)){var c=this.#e.get(i),f=this.#s.get(c);if(f)s(f),this.#o.delete(c);else{var a=this.#t.get(c);a&&(this.#s.set(c,a.effect),this.#t.delete(c),a.fragment.lastChild.remove(),this.anchor.before(a.fragment),f=a.effect)}for(const[e,s]of this.#e){if(this.#e.delete(e),e===i)break;const o=this.#t.get(s);o&&(t(o.effect),this.#t.delete(s))}for(const[e,s]of this.#s){if(e===c||this.#o.has(e))continue;const i=()=>{if(Array.from(this.#e.values()).includes(e)){var o=document.createDocumentFragment();r(s,o),o.append(n()),this.#t.set(e,{effect:s,fragment:o})}else t(s);this.#o.delete(e),this.#s.delete(e)};this.#n||!f?(this.#o.add(e),o(s,i,!1)):i()}}};#c=e=>{this.#e.delete(e);const s=Array.from(this.#e.values());for(const[o,n]of this.#t)s.includes(o)||(t(n.effect),this.#t.delete(o))};ensure(s,t){var o=e,r=a();if(t&&!this.#s.has(s)&&!this.#t.has(s))if(r){var h=document.createDocumentFragment(),d=n();h.append(d),this.#t.set(s,{effect:i(()=>t(d)),fragment:h})}else this.#s.set(s,i(()=>t(this.anchor)));if(this.#e.set(o,s),r){for(const[e,t]of this.#s)e===s?o.skipped_effects.delete(t):o.skipped_effects.add(t);for(const[e,t]of this.#t)e===s?o.skipped_effects.delete(t.effect):o.skipped_effects.add(t.effect);o.oncommit(this.#i),o.ondiscard(this.#c)}else c&&(this.anchor=f),this.#i()}}export{h as B};
