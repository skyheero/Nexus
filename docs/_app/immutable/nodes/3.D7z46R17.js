import{_ as e,i as a}from"../chunks/B-i6IADF.js";import{r as s}from"../chunks/56Csi-eW.js";import{r as n}from"../chunks/pSMJkY9f.js";import{f as t,a as i,c as l}from"../chunks/CnvTZ_2Y.js";import{w as o,o as r,a as d}from"../chunks/D0vQnvVS.js";import{D as u,I as f,Q as c,o as p,a0 as v,J as m,g,aC as h,M as x,O as b,P as w,R as y,F as _,aa as k,ax as j,ah as S,q,aD as C,E as z,H as $,a8 as D,m as L,av as O,aE as E,aF as I,aG as P,aH as M,A as N,C as R,aI as T,ar as A,au as H,B as U,aJ as F,w as J,aK as K,p as B,a as G,b as Q,s as V,c as W,aL as X,e as Y,f as Z,r as ee,h as ae,ai as se,aM as ne}from"../chunks/CPmqCMFw.js";import{d as te,s as ie,e as le}from"../chunks/CDP7CzqO.js";import{s as oe}from"../chunks/DF2Jd5Vp.js";import{b as re}from"../chunks/jviemGrp.js";import{s as de,a as ue}from"../chunks/DKRVt_Ij.js";import{on as fe,off as ce,end as pe,send as ve,clientID as me}from"../chunks/D_JsFh-f.js";function ge(e,a=!0){for(var s=0;s<e.length;s++)U(e[s],a)}var he;function xe(e,a,s,n,t,i=null){var l=e,o=new Map;if(0!==(a&F)){var r=e;l=p?c(v(r)):r.appendChild(u())}p&&m();var d,D=null,L=h(()=>{var e=s();return E(e)?e:null==e?[]:O(e)}),I=!0;function P(){M.fallback=D,function(e,a,s,n,t){var i,l,o,r,d,u=0!==(n&K),f=a.length,c=e.items,p=e.effect.first,v=null,m=[],g=[];if(u)for(d=0;d<f;d+=1)o=t(a[d],d),0===((r=c.get(o).e).f&C)&&(r.nodes?.a?.measure(),(l??=new Set).add(r));for(d=0;d<f;d+=1){if(o=t(a[d],d),r=c.get(o).e,null!==e.outrogroups)for(const a of e.outrogroups)a.pending.delete(r),a.done.delete(r);if(0!==(r.f&C)){if(r.f^=C,r!==p){var h=v?v.next:p;r===e.effect.last&&(e.effect.last=r.prev),r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),ye(e,v,r),ye(e,r,h),we(r,h,s),m=[],g=[],p=(v=r).next;continue}we(r,null,s)}if(0!==(r.f&T)&&(N(r),u&&(r.nodes?.a?.unfix(),(l??=new Set).delete(r))),r!==p){if(void 0!==i&&i.has(r)){if(m.length<g.length){var x,b=g[0];v=b.prev;var w=m[0],y=m[m.length-1];for(x=0;x<m.length;x+=1)we(m[x],b,s);for(x=0;x<g.length;x+=1)i.delete(g[x]);ye(e,w.prev,y.next),ye(e,v,w),ye(e,y,b),p=b,v=y,d-=1,m=[],g=[]}else i.delete(r),we(r,p,s),ye(e,r.prev,r.next),ye(e,r,null===v?e.effect.first:v.next),ye(e,v,r),v=r;continue}for(m=[],g=[];null!==p&&p!==r;)(i??=new Set).add(p),g.push(p),p=p.next;if(null===p)continue}0===(r.f&C)&&m.push(r),v=r,p=r.next}if(null!==e.outrogroups){for(const a of e.outrogroups)0===a.pending.size&&(ge(O(a.done)),e.outrogroups?.delete(a));0===e.outrogroups.size&&(e.outrogroups=null)}if(null!==p||void 0!==i){var _=[];if(void 0!==i)for(r of i)0===(r.f&T)&&_.push(r);for(;null!==p;)0===(p.f&T)&&p!==e.fallback&&_.push(p),p=p.next;var k=_.length;if(k>0){var j=0!==(n&F)&&0===f?s:null;if(u){for(d=0;d<k;d+=1)_[d].nodes?.a?.measure();for(d=0;d<k;d+=1)_[d].nodes?.a?.fix()}!function(e,a,s){for(var n,t=a.length,i=a.length,l=0;l<t;l++){let s=a[l];R(s,()=>{if(n){if(n.pending.delete(s),n.done.add(s),0===n.pending.size){var a=e.outrogroups;ge(O(n.done)),a.delete(n),0===a.size&&(e.outrogroups=null)}}else i-=1},!1)}if(0===i){var o=null!==s;if(o){var r=s,d=r.parentNode;H(d),d.append(r),e.items.clear()}ge(a,!o)}else n={pending:new Set(a),done:new Set},(e.outrogroups??=new Set).add(n)}(e,_,j)}}u&&J(()=>{if(void 0!==l)for(r of l)r.nodes?.a?.apply()})}(M,d,l,a,n),null!==D&&(0===d.length?0===(D.f&C)?N(D):(D.f^=C,we(D,null,l)):R(D,()=>{D=null}))}var M={effect:f(()=>{var e=(d=g(L)).length;let r=!1;p&&(x(l)===b!==(0===e)&&(l=w(),c(l),y(!1),r=!0));for(var f=new Set,v=q,m=$(),h=0;h<e;h+=1){p&&_.nodeType===k&&_.data===j&&(l=_,r=!0,y(!1));var O=d[h],E=n(O,h),M=I?null:o.get(E);M?(M.v&&S(M.v,O),M.i&&S(M.i,h),m&&v.skipped_effects.delete(M.e)):(M=be(o,I?l:he??=u(),O,E,h,t,a,s),I||(M.e.f|=C),o.set(E,M)),f.add(E)}if(0===e&&i&&!D&&(I?D=z(()=>i(l)):(D=z(()=>i(he??=u()))).f|=C),p&&e>0&&c(w()),!I)if(m){for(const[e,a]of o)f.has(e)||v.skipped_effects.add(a.e);v.oncommit(P),v.ondiscard(()=>{})}else P();r&&y(!0),g(L)}),items:o,outrogroups:null,fallback:D};I=!1,p&&(l=_)}function be(e,a,s,n,t,i,l,o){var r=0!==(l&I)?0===(l&P)?L(s,!1,!1):D(s):null,d=0!==(l&M)?D(t):null;return{v:r,i:d,e:z(()=>(i(a,r??s,d??t,o),()=>{e.delete(n)}))}}function we(e,a,s){if(e.nodes)for(var n=e.nodes.start,t=e.nodes.end,i=a&&0===(a.f&C)?a.nodes.start:s;null!==n;){var l=A(n);if(i.before(n),n===t)return;n=l}}function ye(e,a,s){null===a?e.effect.first=s:a.next=s,null===s?e.effect.last=a:s.prev=a}const _e=[..." \t\n\r\fÂ \v\ufeff"];function ke(e,a,s,n,t,i){var l=e.__className;if(p||l!==s||void 0===l){var o=function(e,a,s){var n=null==e?"":""+e;if(s)for(var t in s)if(s[t])n=n?n+" "+t:t;else if(n.length)for(var i=t.length,l=0;(l=n.indexOf(t,l))>=0;){var o=l+i;0!==l&&!_e.includes(n[l-1])||o!==n.length&&!_e.includes(n[o])?l=o:n=(0===l?"":n.substring(0,l))+n.substring(o+1)}return""===n?null:n}(s,0,i);p&&o===e.getAttribute("class")||(null==o?e.removeAttribute("class"):e.className=o),e.__className=s}else if(i&&t!==i)for(var r in i){var d=!!i[r];null!=t&&d===!!t[r]||e.classList.toggle(r,d)}return i}let je=null,Se=null;const qe=Object.freeze(Object.defineProperty({__proto__:null,load:async({url:a})=>{if(Se=a.searchParams.get("uid"),je=a.searchParams.get("name"),!Se||!je){const e=s("/login");throw n(302,e)}if(!("connected"===(await e(()=>import("../chunks/D_JsFh-f.js"),[],import.meta.url)).status)){const e=`${s("/loading")}?uid=${encodeURIComponent(Se)}&name=${encodeURIComponent(je)}`;throw n(302,e)}return{uid:Se,name:je}}},Symbol.toStringTag,{value:"Module"})),Ce=o([]),ze=o([]);var $e=t('<button class="btn btn-square liquid-glass mr-5" aria-label="Close"><span class="icon-[line-md--close-small] size-8 text-secondary"></span></button>'),De=t('<span class="badge badge-primary"> </span>'),Le=t('<li class="w-full"><button><span class="icon-[ic--sharp-account-circle] size-10 text-secondary"></span> <div class="flex flex-col w-[50vw]"><span class="font-medium"> </span> <small class="opacity-70"> </small></div> <div class="flex-1 flex justify-end items-center"><!></div></button></li>'),Oe=t('<p class="font-semibold"> </p>'),Ee=t('<div class="flex justify-end"><div class="max-w-[75%]"><div class="bg-primary text-primary-content px-3 py-2 rounded-3xl rounded-tr-none shadow-sm"><p class="leading-relaxed"> </p></div> <div class="text-right mt-1 text-xs opacity-70"> </div></div></div>'),Ie=t('<div class="flex justify-start"><div class="max-w-[75%]"><div class="bg-base-200 text-base-content px-3 py-2 rounded-3xl rounded-tl-none shadow-sm"><p class="leading-relaxed"> </p></div> <div class="mt-1 text-xs opacity-70"> </div></div></div>'),Pe=t('<main class="col-span-12 md:col-span-8 xl:col-span-9"><div class="liquid-glass rounded-box h-[95vh] flex flex-col relative"><div class="absolute inset-x-0 top-0 p-3 flex items-center"><button class="btn btn-ghost btn-square liquid-glass text-secondary md:hidden" aria-label="Open chats"><span class="icon-[line-md--menu] size-6 text-secondary"></span></button> <div class="flex-1 flex justify-center pointer-events-none"><div class="liquid-glass px-3 py-1 rounded-full flex items-center space-x-3"><!></div></div></div> <div class="flex-1 overflow-y-auto p-3 space-y-3 m-1 mr-2"><div class="pt-6"></div> <!> <div class="pb-20"></div></div> <form class="absolute bottom-0 left-0 right-0 p-3 border-base-300/50"><div class="join w-full"><textarea class="textarea liquid-glass w-full mr-2" rows="1" placeholder="Message"></textarea> <button type="submit" class="btn btn-square liquid-glass mr-5 text-secondary" aria-label="Send message"><span class="icon-[line-md--arrow-up] size-6 text-primary"></span></button></div></form></div></main>'),Me=t('<div class="grid grid-cols-12 p-4 gap-4"><aside><div class="rounded-box h-[95vh] flex flex-col min-h-0"><div class="flex items-center mb-3"><!> <h2 class="text-lg font-semibold"> </h2> <span class="badge liquid-glass ml-3 text-secondary"> </span></div> <div class="mb-3"><input class="input input-bordered w-full liquid-glass" placeholder="Search users" aria-label="Search users"/></div> <div class="menu liquid-glass rounded-box h-full p-2 flex-1 min-h-0"><ul class="w-full overflow-y-auto !grid !grid-cols-1 gap-1"></ul></div></div></aside> <!></div>');function Ne(e,s){B(s,!0);const[n,t]=de();let o=W(""),u=X(()=>me??""),f=W(!1),c=X(()=>ue(Ce,"$users",n)),p=X(()=>ue(ze,"$messages",n)),v=W(void 0),m=W(""),h=X(()=>g(p).filter(e=>e.from===g(u)&&e.to===g(v)||e.from===g(v)&&e.to===g(u)));function x(){const e=g(m).trim();if(!e||!g(v))return;const a={fn:"message",text:e},s={from:g(u),to:g(v),text:e,time:Date.now()};ze.update(e=>[...e,s]),ve(g(v),a),V(m,"")}function b(e){"online_list"!==e.fn?"offline"!==e.fn?"get_info"!==e.fn?"my_info"!==e.fn?"message"!==e.fn?e.fn:function(e){const a=e.cid,s=e.text,n=e.ts,t={from:a,to:g(u),text:s,time:n};ze.update(e=>[...e,t]);(g(f)||a!==g(v))&&Ce.update(e=>e.map(e=>e.id===a?{...e,unreadCount:(e.unreadCount??0)+1}:e))}(e):function(e){const a=e.cid,s=e.name;Ce.update(e=>e.map(e=>e.id===a?{...e,name:s}:e))}(e):function(e){const a=e.cid,s={fn:"my_info",name:g(o)};ve(a,s)}(e):function(e){const a=new Set((e.users??[]).map(e=>e.cid));Ce.update(e=>e.map(e=>a.has(e.id)?{...e,online:!1}:e))}(e):function(e){Ce.update(a=>{const s=e.users??[],n=new Set(s.map(e=>e.cid)),t=new Set(a.map(e=>e.id)),i=a.map(e=>({...e,online:n.has(e.id)}));for(const e of s)if(e.cid!==g(u))if(t.has(e.cid)){const a=i.find(a=>a.id===e.cid);a&&""===a.name&&w(e.cid)}else i.push({id:e.cid,name:"",online:!0,unreadCount:0}),w(e.cid);return i})}(e)}function w(e){ve(e,{fn:"get_info"})}r(()=>{const e=new URLSearchParams(window.location.search),a="undefined"!=typeof sessionStorage?sessionStorage.getItem("chatName"):null;V(o,e.get("name")??a??"unknown",!0),fe("message",b);const s=e=>{ce("message",b),pe()};return window.addEventListener("pagehide",s),()=>{window.removeEventListener("pagehide",s)}}),d(()=>{ce("message",b)});var y=Me(),_=Y(y);let k;var j=Y(_),S=Y(j),q=Y(S),C=e=>{var a=$e();a.__click=()=>V(f,!1),i(e,a)};a(q,e=>{g(f)&&g(v)&&e(C)});var z=Z(q,2),$=Y(z);ee(z);var D=Z(z,2),L=Y(D,!0);ee(D),ee(S);var O=Z(S,4),E=Y(O);xe(E,21,()=>g(c),e=>e.id,(e,s)=>{var n=Le(),t=Y(n);let l;t.__click=()=>{return e=g(s).id,V(v,e,!0),V(f,!1),void Ce.update(a=>a.map(a=>a.id===e?{...a,unreadCount:0}:a));var e};var o=Z(Y(t),2),r=Y(o),d=Y(r,!0);ee(r);var u=Z(r,2),c=Y(u,!0);ee(u),ee(o);var p=Z(o,2),m=Y(p),h=e=>{var a=De(),n=Y(a,!0);ee(a),G(()=>ie(n,g(s).unreadCount)),i(e,a)};a(m,e=>{g(s).unreadCount&&g(s).unreadCount>0&&e(h)}),ee(p),ee(t),ee(n),G(()=>{l=ke(t,0,"w-full flex justify-start",0,l,{active:g(v)===g(s).id}),oe(t,"aria-current",g(v)===g(s).id?"page":void 0),ie(d,g(s).name),ie(c,g(s).online?"Online":"Offline")}),i(e,n)}),ee(E),ee(O),ee(j),ee(_);var I=Z(_,2),P=e=>{var s=Pe(),n=Y(s),t=Y(n),o=Y(t);o.__click=()=>V(f,!0);var r=Z(o,2),d=Y(r),p=Y(d),b=e=>{var a=l();xe(ae(a),17,()=>g(c).filter(e=>e.id===g(v)),e=>e.id,(e,a)=>{var s=Oe(),n=Y(s,!0);ee(s),G(()=>ie(n,g(a).name)),i(e,s)}),i(e,a)};a(p,e=>{g(v)&&e(b)}),ee(d),ee(r),ee(t);var w=Z(t,2);xe(Z(Y(w),2),17,()=>g(h),e=>`${e.from}-${e.to}-${e.time}`,(e,s)=>{var n=l(),t=ae(n),o=e=>{var a=Ee(),n=Y(a),t=Y(n),l=Y(t),o=Y(l,!0);ee(l),ee(t);var r=Z(t,2),d=Y(r,!0);ee(r),ee(n),ee(a),G(e=>{ie(o,g(s).text),ie(d,e)},[()=>new Date(g(s).time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),i(e,a)},r=e=>{var a=Ie(),n=Y(a),t=Y(n),l=Y(t),o=Y(l,!0);ee(l),ee(t);var r=Z(t,2),d=Y(r,!0);ee(r),ee(n),ee(a),G(e=>{ie(o,g(s).text),ie(d,e)},[()=>new Date(g(s).time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),i(e,a)};a(t,e=>{g(s).from===g(u)?e(o):e(r,!1)}),i(e,n)}),se(2),ee(w);var y=Z(w,2),_=Y(y),k=Y(_);ne(k),k.__keydown=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),x())},se(2),ee(_),ee(y),ee(n),ee(s),le("submit",y,e=>{e.preventDefault(),x()}),re(k,()=>g(m),e=>V(m,e)),i(e,s)};a(I,e=>{!g(f)&&g(v)&&e(P)}),ee(y),G(()=>{k=ke(_,0,"col-span-12 md:col-span-4 xl:col-span-3",0,k,{hidden:!g(f)&&g(v),"md:block":!g(f)&&g(v)}),ie($,`Hi ${g(o)??""}`),ie(L,g(c).length)}),i(e,y),Q(),t()}te(["click","keydown"]);export{Ne as component,qe as universal};
