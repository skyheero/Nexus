import{i as n,_ as s}from"../chunks/B-i6IADF.js";import{f as e,a,c as r}from"../chunks/CnvTZ_2Y.js";import{o as t,a as o}from"../chunks/D0vQnvVS.js";import{p as i,a as c,b as l,s as m,c as d,g as u,e as f,r as v,f as h,h as p}from"../chunks/CPmqCMFw.js";import{s as g}from"../chunks/CDP7CzqO.js";import{g as j}from"../chunks/-4ANX-ws.js";import{r as k}from"../chunks/56Csi-eW.js";import{p as w}from"../chunks/CncVztrg.js";var x=e('<div class="loading loading-spinner loading-lg"></div>'),_=e('<div class="mt-2 text-sm opacity-70"> </div>'),b=e('<div class="alert">Unable to reach the chat server. Retrying… <!></div>'),y=e('<div class="min-h-[70vh] flex items-center justify-center p-6"><div class="liquid-glass rounded-box p-6 w-full max-w-md text-center"><h1 class="text-xl font-semibold mb-2"> </h1> <!></div></div>');function E(e,E){i(E,!0);let R=d(null),$=d(null),C=d("idle"),I=d(void 0),L=null,P=null,U=null;function q(n){if("connecting"===n||"reconnecting"===n)m(C,"connecting");else if("connected"===n){m(C,"connected");const n=`${k("/chat")}?uid=${encodeURIComponent(u(R))}&name=${encodeURIComponent(u($))}`;j(n,{replaceState:!0})}}function A(n){m(I,n,!0),m(C,"error")}t(()=>{!async function(){if(L=await s(()=>import("../chunks/D_JsFh-f.js"),[],import.meta.url),m(R,w.url.searchParams.get("uid"),!0),m($,w.url.searchParams.get("name"),!0),!u(R)||!u($))return void(await j(k("/login")));m(C,"connecting"),L.on("status",q),L.on("error",A),P=()=>L.off("status",q),U=()=>L.off("error",A);try{await L.start(u(R))}catch(n){m(I,n.message,!0),m(C,"error")}}();const n=n=>{L?.end?.()};return window.addEventListener("pagehide",n),()=>{window.removeEventListener("pagehide",n)}}),o(()=>{P?.(),U?.()});var D=y(),O=f(D),S=f(O),T=f(S);v(S);var V=h(S,2),z=n=>{var s=x();a(n,s)},B=s=>{var e=r(),t=p(e),o=s=>{var e=b(),r=h(f(e)),t=n=>{var s=_(),e=f(s,!0);v(s),c(()=>g(e,u(I))),a(n,s)};n(r,n=>{u(I)&&n(t)}),v(e),a(s,e)};n(t,n=>{"error"===u(C)&&n(o)},!0),a(s,e)};n(V,n=>{"connecting"===u(C)?n(z):n(B,!1)}),v(O),v(D),c(()=>g(T,`Connecting to server…${u(C)??""}`)),a(e,D),l()}export{E as component};
